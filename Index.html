<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TheBikerZone | Social Feed</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
</head>
<body class="bg-gray-50">
<div id="root"></div>

<script>
const { useState, useEffect } = React;

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBmbEztflh7PrcHKggM2-lzoMhzNkOup5o",
  authDomain: "thebikerzone-54094.firebaseapp.com",
  projectId: "thebikerzone-54094",
  storageBucket: "thebikerzone-54094.firebasestorage.app",
  messagingSenderId: "654294837831",
  appId: "1:654294837831:web:1c73e7707de9a2fd4a5f62"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
const provider = new firebase.auth.GoogleAuthProvider();

function App() {
  const [user, setUser] = useState(null);
  const [posts, setPosts] = useState([]);
  const [newPost, setNewPost] = useState({content:"", tags:""});
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const unsubAuth = auth.onAuthStateChanged(u => setUser(u));
    loadPosts();
    return () => unsubAuth();
  }, []);

  function loadPosts() {
    db.collection("posts").orderBy("created_at","desc").get()
      .then(snapshot => {
        const data = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
        setPosts(data);
        setLoading(false);
      }).catch(console.error);
  }

  function addPost(e){
    e.preventDefault();
    if(!user) return alert("Accedi con Google per postare!");
    db.collection("posts").add({
      content: newPost.content,
      username: user.displayName,
      likes:0,
      tags: newPost.tags.split(",").map(t=>t.trim()).filter(Boolean),
      created_at: new Date()
    }).then(()=>{
      setNewPost({content:"", tags:""});
      loadPosts();
    }).catch(console.error);
  }

  function addLike(postId){
    if(!user) return alert("Accedi per mettere mi piace!");
    const ref = db.collection("posts").doc(postId);
    db.runTransaction(tx => {
      return tx.get(ref).then(doc=>{
        if(!doc.exists) return;
        tx.update(ref,{likes:(doc.data().likes||0)+1});
      });
    }).then(loadPosts).catch(console.error);
  }

  return React.createElement("div",{className:"max-w-3xl mx-auto py-6"},
    React.createElement("header",{className:"flex justify-between items-center mb-6"},
      React.createElement("h1",{className:"text-3xl font-bold text-orange-600"},"üèçÔ∏è TheBikerZone"),
      user ?
        React.createElement("div",{className:"flex items-center gap-3"},
          React.createElement("span",null,"üëã ",user.displayName),
          React.createElement("button",{onClick:()=>auth.signOut(), className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300"},"Logout")
        ) :
        React.createElement("button",{onClick:()=>auth.signInWithPopup(provider), className:"px-3 py-1 bg-orange-600 text-white rounded hover:bg-orange-700"},"Accedi con Google")
    ),

    user && React.createElement("form",{onSubmit:addPost,className:"bg-white p-4 rounded shadow mb-6 flex flex-col gap-3"},
      React.createElement("textarea",{className:"w-full border p-2 rounded",value:newPost.content,onChange:e=>setNewPost({...newPost, content:e.target.value}),placeholder:"Scrivi qualcosa...", required:true}),
      React.createElement("input",{type:"text", placeholder:"Tag separati da virgola", className:"border p-2 rounded", value:newPost.tags, onChange:e=>setNewPost({...newPost, tags:e.target.value})}),
      React.createElement("button",{className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700"},"Pubblica")
    ),

    loading?React.createElement("p",{className:"text-center"},"‚è≥ Caricamento...") :
    posts.map(post=>React.createElement("div",{key:post.id,className:"bg-white p-4 rounded shadow mb-6"},
      React.createElement("p",{className:"text-gray-800"},post.content),
      post.tags && React.createElement("div",{className:"mt-2 flex gap-2"}, post.tags.map((tag,i)=>React.createElement("span",{key:i,className:"bg-gray-200 px-2 py-1 rounded text-sm"},"#",tag))),
      React.createElement("div",{className:"flex justify-between text-sm text-gray-500 mt-2"},
        React.createElement("span",null,"‚úçÔ∏è ",post.username),
        React.createElement("button",{onClick:()=>addLike(post.id), className:"text-red-500 hover:scale-110 transition"},"‚ù§Ô∏è ",post.likes||0)
      )
    ))
  );
}

ReactDOM.render(React.createElement(App), document.getElementById("root"));
</script>
</body>
</html>
