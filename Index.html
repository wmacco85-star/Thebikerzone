<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TheBikerZone</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
</head>

<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/javascript">
    // 🔥 Configurazione Firebase (inserita da te)
    const firebaseConfig = {
      apiKey: "AIzaSyBmbEztflh7PrcHKggM2-lzoMhzNkOup5o",
      authDomain: "thebikerzone-54094.firebaseapp.com",
      projectId: "thebikerzone-54094",
      storageBucket: "thebikerzone-54094.firebasestorage.app",
      messagingSenderId: "654294837831",
      appId: "1:654294837831:web:1c73e7707de9a2fd4a5f62"
    };

    // ✅ Inizializza Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const e = React.createElement;
    const { useState, useEffect } = React;

    function App() {
      const [posts, setPosts] = useState([]);
      const [user, setUser] = useState(null);
      const [newPost, setNewPost] = useState({ title: "", content: "", type: "news" });

      // 🔁 Caricamento dei post
      useEffect(() => {
        db.collection("posts").orderBy("created_at", "desc").onSnapshot((snapshot) => {
          const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          setPosts(data);
        });
      }, []);

      // ✍️ Pubblicazione di un post
      async function handlePost(e) {
        e.preventDefault();
        if (!user) {
          alert("Effettua il login per pubblicare");
          return;
        }
        await db.collection("posts").add({
          title: newPost.title,
          content: newPost.content,
          type: newPost.type,
          username: user.displayName || "Biker",
          created_at: firebase.firestore.FieldValue.serverTimestamp(),
        });
        setNewPost({ title: "", content: "", type: "news" });
      }

      // 🔐 Login simulato (puoi collegare GoogleAuth se vuoi)
      function handleLogin() {
        const name = prompt("Inserisci il tuo nome:");
        if (name) setUser({ displayName: name });
      }

      function handleLogout() {
        setUser(null);
      }

      return e("div", { className: "max-w-3xl mx-auto p-4" },

        // Header
        e("header", { className: "flex justify-between items-center mb-6" },
          e("h1", { className: "text-3xl font-bold text-orange-600" }, "🏍️ TheBikerZone"),
          user
            ? e("div", { className: "flex items-center gap-2" },
                e("span", null, "👋 " + user.displayName),
                e("button", {
                  onClick: handleLogout,
                  className: "bg-gray-200 px-3 py-1 rounded hover:bg-gray-300"
                }, "Logout"))
            : e("button", {
                onClick: handleLogin,
                className: "bg-orange-600 text-white px-3 py-1 rounded hover:bg-orange-700"
              }, "Login")
        ),

        // Form per nuovo post
        e("form", { onSubmit: handlePost, className: "bg-white p-4 rounded shadow mb-6" },
          e("input", {
            type: "text",
            placeholder: "Titolo",
            value: newPost.title,
            onChange: (ev) => setNewPost({ ...newPost, title: ev.target.value }),
            className: "w-full border p-2 rounded mb-2"
          }),
          e("textarea", {
            placeholder: "Scrivi il tuo post...",
            value: newPost.content,
            onChange: (ev) => setNewPost({ ...newPost, content: ev.target.value }),
            className: "w-full border p-2 rounded mb-2"
          }),
          e("select", {
            value: newPost.type,
            onChange: (ev) => setNewPost({ ...newPost, type: ev.target.value }),
            className: "w-full border p-2 rounded mb-2"
          },
            e("option", { value: "news" }, "News"),
            e("option", { value: "event" }, "Evento"),
            e("option", { value: "ride" }, "Motogiro")
          ),
          e("button", {
            type: "submit",
            className: "bg-orange-600 text-white w-full p-2 rounded hover:bg-orange-700"
          }, "🚀 Pubblica")
        ),

        // Lista dei post
        posts.map(post =>
          e("div", { key: post.id, className: "bg-white p-4 rounded shadow mb-4" },
            e("h2", { className: "text-xl font-bold text-orange-700 mb-2" }, post.title),
            e("p", { className: "mb-2" }, post.content),
            e("span", { className: "text-sm text-gray-500" },
              post.username ? "👤 " + post.username : "",
              " • ",
              post.type.toUpperCase()
            )
          )
        )
      );
    }

    ReactDOM.render(e(App), document.getElementById("root"));
  </script>
</body>
</html>
